{% load irpf_tags %}
{% with asset_period=item.asset.period %}
<div class="card mt-1 mb-2 unsort irpfreport">
  <div class="card-header">
    <button type="button" class="btn btn-link" data-toggle="collapse" data-target="#collapsebody-{{ forloop.counter }}"
            aria-expanded="true" aria-controls="collapsebody-{{ forloop.counter }}">
      {{ item.code }}{% if item.enterprise %} - {{ item.enterprise.name }} ({{ item.enterprise.cnpj }}){% endif %}
    </button>
    <button type="button" class="btn btn-link" data-toggle="popover"
            data-content="
        {% if item.enterprise %}
          {{ asset_period.quantity }}
          {% if item.enterprise.is_fii %}cota{{ asset_period.quantity|pluralize:"s" }}
          {% elif item.enterprise.is_stock %}ações
          {% elif item.enterprise.is_bdr %}bdr{{ asset_period.quantity|pluralize:"s" }}
          {% endif %}
          {{ item.code }} // {{ item.enterprise.name }} - {{ item.enterprise.cnpj }}
          {% if item.enterprise.adminstrator %} // Adminstrador: {{ item.enterprise.adminstrator.name }} - {{ item.enterprise.adminstrator.cnpj }}{% endif %}
        {% else %}
          {{ item.code }}
        {% endif %}">
      <i class="fa fa-info-circle"></i>
    </button>

  </div>
  <div id="collapsebody-{{ forloop.counter }}" class="collapse show">
    <div class="card-body p-2">
      {% if item.asset.position %}
       {% include "irpf/adminx_report_irpf_asset_position.html" with card_title_class="text-primary" %}
      {% endif %}

      {% if item.asset.sell %}
        {% include "irpf/adminx_report_irpf_asset_sell.html" with card_title="Vendas do período" card_title_class="text-danger"%}
      {% endif %}

      {% include "irpf/adminx_report_irpf_asset_period.html" with card_title="Posição do período" card_title_class="text-success"%}

      {% if item.asset.credit or item.asset.debit %}
        {% include "irpf/adminx_report_irpf_asset_movement.html" with card_title="Movimentações" card_title_class="text-info"%}
      {% endif %}

      {% if item.asset.events.bonus %}
        {% for bonus in item.asset.events.bonus %}
          {% include "irpf/adminx_report_irpf_bonus_item.html" with card_title_class="text-info" %}
        {% endfor %}
      {% endif %}

      {% if item.enterprise and item.enterprise.bookkeeping %}
        <hr/>
        <p class="card-subtitle text-info">Escriturador:
        <a href="{{ item.enterprise.bookkeeping.link }}" target="_blank">{{ item.enterprise.bookkeeping.name }}</a>
        </p>
      {% endif %}
    </div>
  </div>
</div>
{% endwith %}