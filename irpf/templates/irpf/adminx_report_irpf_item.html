{% load irpf_tags %}
{% with asset_buy=item.asset.buy %}
<div class="card mt-1 mb-2 unsort irpfreport">
  <div class="card-header">
    <button type="button" class="btn btn-link" data-toggle="collapse" data-target="#collapsebody-{{ forloop.counter }}"
            aria-expanded="true" aria-controls="collapsebody-{{ forloop.counter }}">
      {{ item.code }}{% if item.instance %} - {{ item.instance.name }} ({{ item.instance.cnpj }}){% endif %}
    </button>
    <button type="button" class="btn btn-link" data-toggle="popover"
            data-content="
        {% if item.instance %}
          {{ asset_buy.quantity|as_int_desc }}
          {% if item.instance.is_fii %}cota{{ asset_buy.quantity|pluralize:"s" }}
          {% elif item.instance.is_stock %}ações
          {% elif item.instance.is_bdr %}bdr{{ asset_buy.quantity|pluralize:"s" }}
          {% endif %}
          {{ item.code }} // {{ item.instance.name }} - {{ item.instance.cnpj }}
          {% if item.instance.administrator %} // Administrador: {{ item.instance.administrator.name }} - {{ item.instance.administrator.cnpj }}{% endif %}
        {% else %}
          {{ item.code }}
        {% endif %}">
      <i class="fa fa-info-circle"></i>
    </button>

  </div>
  <div id="collapsebody-{{ forloop.counter }}" class="collapse show">
    <div class="card-body p-2">
      {% if item.asset.position %}
       {% include "irpf/adminx_report_irpf_asset_position.html" with card_title_class="text-primary" %}
      {% endif %}

      {% if item.asset.sell %}
        {% include "irpf/adminx_report_irpf_asset_sell.html" with card_title="Vendas do período" card_title_class="text-danger"%}
      {% endif %}

      {% if item.asset.buy %}
      {% include "irpf/adminx_report_irpf_asset_period.html" with card_title="Posição do período" card_subtitle=report.end_date card_title_class="text-success"%}
      {% endif %}

      {% if item.asset.credit or item.asset.debit %}
        {% include "irpf/adminx_report_irpf_asset_movement.html" with card_title="Movimentações" card_title_class="text-info"%}
      {% endif %}

      {% if item.asset.events.bonus %}
          {% include "irpf/adminx_report_irpf_bonus_item.html" with card_title_class="text-info" %}
      {% endif %}

      {% if item.asset.events.subscription %}
          {% include "irpf/adminx_report_irpf_subscription_item.html" with card_title_class="text-info" %}
      {% endif %}

      {% if item.instance and item.instance.bookkeeping %}
        <hr/>
        <p class="card-subtitle text-info">Escriturador:
        <a href="{{ item.instance.bookkeeping.link }}" target="_blank">{{ item.instance.bookkeeping.name }}</a>
        </p>
      {% endif %}
    </div>
  </div>
</div>
{% endwith %}